<!-- 仪表盘内容组件 -->
<section class="dashboard-content flex flex-col gap-8">
  <header class="dashboard-header flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
    <div>
      <h2 class="text-3xl font-semibold text-slate-900">提醒面板</h2>
      <p class="text-sm text-slate-500 mt-2">集中管理任务、分类与设备，以更紧凑的视图掌控所有推送节奏。</p>
    </div>
    <div class="flex flex-wrap gap-3">
      <div class="metric-pill">
        <span class="metric-pill__value" x-text="tasks.length"></span>
        <span class="metric-pill__label">提醒总数</span>
      </div>
      <div class="metric-pill">
        <span class="metric-pill__value text-emerald-500" x-text="tasks.filter(t => t.enabled).length"></span>
        <span class="metric-pill__label">正在进行</span>
      </div>
      <div class="metric-pill">
        <span class="metric-pill__value text-slate-500" x-text="devices.length"></span>
        <span class="metric-pill__label">使用设备</span>
      </div>
    </div>
  </header>

  <div class="insights-grid">
    <!-- 发送记录面板 -->
    <div class="surface-card execution-logs-panel">
      <div class="execution-logs-header">
        <div class="flex items-center gap-3">
          <h3 class="text-lg font-semibold text-gray-900">发送记录</h3>
          <div class="flex items-center gap-2 text-xs text-gray-500" aria-live="polite">
            <span id="connection-indicator" class="connection-indicator connection-disconnected" aria-hidden="true"></span>
            <span id="connection-status-text">实时连接初始化中</span>
          </div>
        </div>
        <div class="flex items-center gap-2" x-data="{ open: false }" @keydown.escape.window="open = false" @click.away="open = false">
          <select x-model="logsFilter" @change="loadExecutionLogs()" class="text-sm border rounded px-2 py-1">
            <option value="all">全部</option>
            <option value="success">成功</option>
            <option value="failed">失败</option>
          </select>
          <div class="relative">
            <button type="button"
                    @click="open = !open"
                    class="btn-icon"
                    :class="open ? 'text-blue-600 bg-blue-50' : ''"
                    aria-haspopup="true"
                    :aria-expanded="open.toString()"
                    aria-controls="logs-action-menu"
                    title="更多操作">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zm6 0a2 2 0 11-4 0 2 2 0 014 0zm6 0a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </button>
            <div x-cloak
                 x-show="open"
                 x-transition.opacity
                 id="logs-action-menu"
                 class="absolute right-0 z-20 mt-2 w-56 rounded-2xl border border-gray-100 bg-white p-3 shadow-lg">
              <button type="button"
                      @click="open = false; loadExecutionLogs();"
                      class="w-full rounded-lg px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50">
                手动刷新发送记录
              </button>
              <p class="mt-2 text-xs leading-relaxed text-gray-500">
                仅当上方实时指示变灰或红色时再使用手动刷新。
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="execution-logs-content">
        <template x-if="executionLogs && executionLogs.length > 0">
          <div class="space-y-2">
            <template x-for="log in executionLogs" :key="log.id">
              <div class="execution-log-item" :class="log.status === 'success' ? 'log-success' : 'log-failed'">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <div class="flex items-center gap-2">
                      <span class="text-xs" x-text="log.status === 'success' ? '✅' : '❌'"></span>
                      <span class="font-medium text-sm" x-text="UIUtils.displayTitle(log.taskTitle)" :title="log.taskTitle"></span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                      <span x-text="log.deviceName"></span>
                      <span class="mx-1">·</span>
                      <span x-text="formatTime(log.timestamp)"></span>
                    </div>
                    <template x-if="log.error">
                      <div class="text-xs text-red-500 mt-1" x-text="log.error"></div>
                    </template>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </template>
        <template x-if="!executionLogs || executionLogs.length === 0">
          <div class="text-center text-gray-500 text-sm py-4">
            暂无发送记录
          </div>
        </template>
      </div>
    </div>
    <div class="surface-card quick-card">
      <h3 class="text-lg font-semibold text-gray-900 mb-3">今日概览</h3>
      <ul class="quick-card__list">
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">今日成功</span>
          <span class="text-sm font-semibold text-emerald-500" x-text="todayStats.success + ' 次'"></span>
        </li>
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">今日失败</span>
          <span class="text-sm font-semibold text-red-500" x-text="todayStats.failed + ' 次'"></span>
        </li>
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">成功率</span>
          <span class="text-sm font-semibold text-blue-500" x-text="todayStats.successRate + '%'"></span>
        </li>
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">活跃任务</span>
          <span class="text-sm font-semibold text-gray-700" x-text="tasks.filter(t => t.enabled).length + ' 个'"></span>
        </li>
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">总任务数</span>
          <span class="text-sm font-semibold text-gray-700" x-text="tasks.length + ' 个'"></span>
        </li>
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">绑定设备</span>
          <span class="text-sm font-semibold text-gray-700" x-text="devices.length + ' 台'"></span>
        </li>
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">待执行</span>
          <span class="text-sm font-semibold text-amber-500" x-text="todayStats.pending + ' 个'"></span>
        </li>
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">本周推送</span>
          <span class="text-sm font-semibold text-indigo-500" x-text="todayStats.weekTotal + ' 次'"></span>
        </li>
        <li class="quick-card__item">
          <span class="text-sm text-gray-500">平均耗时</span>
          <span class="text-sm font-semibold text-purple-500" x-text="todayStats.avgTime + ' ms'"></span>
        </li>
      </ul>
    </div>
  </div>
</section>
